<!DOCTYPE html>
<html 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/defaultLayout}">
<section layout:fragment="content" class="contents">
	<div class="orangeBox d-flex justify-content-center">
		<div class="h-100 w-75">
			<!-- 제목 및 배열순위버튼 -->
			<div class="exchangeLetter d-flex">
				<div class="h-100 w-75 d-flex align-items-center justify-content-end">
					<span class="exchangeLetter1 mr-5 pr-5">중고거래 인기매물</span>
				</div>
				<div class="h-100 w-25 d-flex justify-content-center align-items-center">
					<select id="listOrder">
					  <option selected value="latestOrder">최신 제품순</option>
					  <option value="popularityOrder">인기순</option>
					  <option value="descendingOrder">높은 가격순</option>
					  <option value="ascendingOrder">낮은 가격순</option>
					</select>
				</div>
			</div>
			
			<!-- 물품 리스트 -->
			<div class="exchangeList d-flex flex-wrap" th:fragment="postListFragment">
				<!-- 제품 1개 -->
				<div th:each="cardView : ${cardViewList}" class="productOne mr-1 ml-2 d-flex justify-content-center">
					<div class="h-100 w-75">
						<a th:href="|/post/post-detail-view?postId=${cardView.post.id}|" class="postAnchor">
							<img th:src="${cardView.image.imagePath}" class="productImage mt-1 rounded" alt="제품 이미지">						
							<div class="pl-1 pt-1">
								<div class="postSubject" th:text="${cardView.post.subject}"></div>
								<div class="postPrice font-weight-bold pt-1" th:text="${cardView.post.price} + '원'"></div>
								<div class="postAddress pt-1" th:text="${cardView.post.address}"></div>
								<div class="likeCount pt-1" th:text="'관심 ' + ${cardView.likeCount}"></div>
							</div>
						</a>
					</div>
				</div>
			</div>
			
			<!-- 페이지 이동 -->
			<div class="changePage d-flex justify-content-center">
				<nav aria-label="Page navigation example">
				  <ul class="pagination">
				    <li class="page-item">
				      <a class="page-link" href="#" aria-label="Previous">
				        <span aria-hidden="true">&laquo;</span>
				      </a>
				    </li>
				    <li class="page-item active">
				    	<a class="page-link" href="#" data-page="1">1</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="2">2</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="3">3</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="4">4</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="5">5</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="6">6</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="7">7</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="8">8</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="9">9</a>
				    </li>
				    <li class="page-item">
				    	<a class="page-link" href="#" data-page="10">10</a>
				    </li>
				    <li class="page-item">
				      <a class="page-link" href="#" aria-label="Next">
				        <span aria-hidden="true">&raquo;</span>
				      </a>
				    </li>
				  </ul>
				</nav>
			</div>
		</div>
	</div>
</section>

<th:block layout:fragment="script">
    <script>
		$(document).ready(function() {
			// 기본 게시글 정렬 최신순
			let defaultOrder = 'latestOrder';
			// 시작 페이지 1
			let currentPage = 1;
			
			function fetchPosts(listOrder, page) {
				$.ajax({
					url: "/post/post-list-view"
					, type: "GET"
					, data: {"listOrder":listOrder, "currentPage":page}
					, success:function(data) {
						$(".exchangeList").html(data);
					}
					, error:function(error) {
						alert("리스트 배열에 실패했습니다.");
					}
				});
			}
			
			fecthPosts(defaultOrder, currentPage);
			
			$("#listOrder").on('change', function() {
				let listOrder = $(this).val();
				//alert(listOrder);
				
				$.ajax({
					url: "/post/post-list-view"
					, type: "GET"
					, data: {"listOrder":listOrder}
					, success:function(data) {
						$(".exchangeList").html(data);
					}
					, error:function(error) {
						alert("리스트 배열에 실패했습니다.");
					}
				});
			});
			
			$(".page-link").on('click', function(e) {
				alert("클릭");
				e.preventDefault();
				
				currentPage = $(this).data("page");
				alert(currentPage);
				
				$(".page-item").removeClass("disabled");
				$(this).parent().addClass("disabled");
				
				fetchPosts($("#listOrder").val(), currentPage);
			});
		});
    </script>
</th:block>